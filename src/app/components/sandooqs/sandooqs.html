<div class="sandooqs-container">
  <!-- Header Section -->
  <div class="sandooqs-header">
    <div class="header-content">
      <div class="header-text">
        <h1>ุตูุงุฏููู</h1>
        <p>ุฅุฏุงุฑุฉ ุตูุงุฏูู ุงูุงุฏุฎุงุฑ ุงูุนุงุฆููุฉ ูุชุชุจุน ุงููุนุงููุงุช</p>
      </div>
      <button
        class="btn btn-primary create-btn"
        (click)="toggleCreateForm()"
        [disabled]="isLoading"
      >
        <span class="btn-icon">โ</span>
        ุฅูุดุงุก ุตูุฏูู ุฌุฏูุฏ
      </button>
    </div>
  </div>

  <!-- Create Form -->
  @if (showCreateForm) {
  <div class="create-form-container">
    <div class="create-form">
      <h3>ุฅูุดุงุก ุตูุฏูู ุฌุฏูุฏ</h3>
      <form (ngSubmit)="createSandooq()" #createForm="ngForm">
        <div class="form-row">
          <div class="form-group">
            <label for="sandooqName">ุงุณู ุงูุตูุฏูู *</label>
            <input
              type="text"
              id="sandooqName"
              [(ngModel)]="newSandooq.name"
              name="sandooqName"
              placeholder="ุฃุฏุฎู ุงุณู ุงูุตูุฏูู (ูุซุงู: ุตูุฏูู ุงูุฅุฌุงุฒุฉ ุงูุนุงุฆููุฉ)"
              required
              maxlength="100"
              class="form-input"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="monthlyPayment">ุงูุฏูุนุฉ ุงูุดูุฑูุฉ (ุฑูุงู) *</label>
            <input
              type="number"
              id="monthlyPayment"
              [(ngModel)]="newSandooq.monthlyPayment"
              name="monthlyPayment"
              placeholder="ูุซุงู: 500"
              required
              min="1"
              step="0.01"
              class="form-input"
            />
            <small class="form-hint">ุงููุจูุบ ุงููุทููุจ ูู ูู ุนุถู ุดูุฑูุงู</small>
          </div>

          <div class="form-group">
            <label for="maxInvestmentPercentage"
              >ูุณุจุฉ ุงูุงุณุชุซูุงุฑ ุงููุตูู (%) *</label
            >
            <input
              type="number"
              id="maxInvestmentPercentage"
              [(ngModel)]="newSandooq.maxInvestmentPercentage"
              name="maxInvestmentPercentage"
              placeholder="ูุซุงู: 15"
              required
              min="1"
              max="100"
              step="0.1"
              class="form-input"
            />
            <small class="form-hint"
              >ุฃูุตู ูุณุจุฉ ูููู ุงุณุชุซูุงุฑูุง ูู ุฑุตูุฏ ุงูุตูุฏูู</small
            >
          </div>
        </div>
        <div class="form-actions">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="toggleCreateForm()"
            [disabled]="isCreating"
          >
            ุฅูุบุงุก
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="
              isCreating ||
              !newSandooq.name.trim() ||
              newSandooq.monthlyPayment <= 0
            "
          >
            @if (isCreating) {
            <span class="loading-spinner"></span>
            ุฌุงุฑู ุงูุฅูุดุงุก... } @else { ุฅูุดุงุก ุงูุตูุฏูู }
          </button>
        </div>
      </form>
    </div>
  </div>
  }

  <!-- Error Message -->
  @if (errorMessage) {
  <div class="error-message">
    <span class="error-icon">โ๏ธ</span>
    {{ errorMessage }}
    <button class="retry-btn" (click)="loadSandooqs()">ุฅุนุงุฏุฉ ุงููุญุงููุฉ</button>
  </div>
  }

  <!-- Loading State -->
  @if (isLoading && !(sandooqs$ | async)) {
  <div class="loading-container">
    <div class="loading-spinner large"></div>
    <p>ุฌุงุฑู ุชุญููู ุตูุงุฏููู...</p>
  </div>
  }

  <!-- Sandooqs Grid -->
  @if (sandooqs$ | async; as sandooqs) { @if (sandooqs.length > 0) {
  <div class="sandooqs-grid">
    @for (sandooq of sandooqs; track sandooq.id) {
    <div class="sandooq-card" (click)="viewSandooq(sandooq.id)">
      <!-- Card Header -->
      <div class="card-header">
        <div class="sandooq-info">
          <h3>{{ sandooq.name }}</h3>
          @if (sandooq.description) {
          <p class="description">{{ sandooq.description }}</p>
          }
        </div>
        <div class="owner-badge">
          @if (sandooq.isOwner) {
          <span class="badge owner">๐ ุงููุงูู</span>
          } @else {
          <span class="badge member">๐ฅ ุนุถู</span>
          }
        </div>
      </div>

      <!-- Balance Display -->
      <div class="balance-section">
        <div
          class="balance-amount"
          [class]="getBalanceColor(sandooq.totalBalance)"
        >
          {{ formatCurrency(sandooq.totalBalance) }}
        </div>
        <div class="balance-label">ุงูุฑุตูุฏ ุงูุญุงูู</div>
      </div>

      <!-- Financial Info -->
      <div class="financial-info">
        <div class="info-item">
          <span class="info-label">ุงูุฏูุนุฉ ุงูุดูุฑูุฉ:</span>
          <span class="info-value">{{
            formatCurrency(sandooq.monthlyPayment)
          }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">ูุณุจุฉ ุงูุงุณุชุซูุงุฑ:</span>
          <span class="info-value">{{ sandooq.maxInvestmentPercentage }}%</span>
        </div>
      </div>

      <!-- Stats -->
      <div class="stats-section">
        <div class="stat-item">
          <span class="stat-icon">๐ฅ</span>
          <span class="stat-value">{{ sandooq.totalMembers }}</span>
          <span class="stat-label">ุงูุฃุนุถุงุก</span>
        </div>
        <div class="stat-item">
          <span class="stat-icon">๐</span>
          <span class="stat-value">{{ sandooq.totalTransactions }}</span>
          <span class="stat-label">ุงููุนุงููุงุช</span>
        </div>
        <div class="stat-item">
          <span class="stat-icon">๐</span>
          <span class="stat-value">{{
            getLastActivityText(sandooq.lastActivity)
          }}</span>
          <span class="stat-label">ุขุฎุฑ ูุดุงุท</span>
        </div>
      </div>

      <!-- Actions -->
      <div class="card-actions">
        <button class="action-btn view-btn">
          <span class="btn-icon">๐๏ธ</span>
          ุนุฑุถ ุงูุชูุงุตูู
        </button>
        @if (sandooq.isOwner) {
        <button
          class="action-btn delete-btn"
          (click)="deleteSandooq(sandooq, $event)"
          title="ุญุฐู ุงูุตูุฏูู"
        >
          <span class="btn-icon">๐๏ธ</span>
        </button>
        }
      </div>
    </div>
    }
  </div>
  } @else {
  <!-- Empty State -->
  <div class="empty-state">
    <div class="empty-icon">๐ฆ</div>
    <h2>ูุง ุชูุฌุฏ ุตูุงุฏูู ุจุนุฏ</h2>
    <p>ุฃูุดุฆ ุตูุฏููู ุงูุฃูู ูุจุฏุก ุฅุฏุงุฑุฉ ูุฏุฎุฑุงุช ุงูุนุงุฆูุฉ</p>
    <button class="btn btn-primary" (click)="toggleCreateForm()">
      <span class="btn-icon">โ</span>
      ุฅูุดุงุก ุตูุฏููู ุงูุฃูู
    </button>
  </div>
  } }
</div>
